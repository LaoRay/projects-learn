webpackJsonp([4],{2:function(t,e){"use strict";function n(t){$http.defaults.headers.Authorization=t}Object.defineProperty(e,"__esModule",{value:!0});var o=window.CONFIG.DEV?window.CONFIG.API_DEV:window.CONFIG.API_HOST,i=function(t){window.alert(t)};$http.defaults.headers.sessionId=window.sessionStorage.getItem("sessionId");var s={SUCCESS:"0",TIMEOUT:"500",TOKEN_INVALID:"5001",CODE_INVALID:"5002"};$http.interceptors.response.use(function(t){var e=t.meta&&t.meta.code+"";switch(e){case s.SUCCESS:return t;case s.TOKEN_INVALID:case s.CODE_INVALID:return window.sessionStorage.removeItem("sessionId"),$http.defaults.headers.sessionId=void 0,i(t.meta.message||"当前会话已过期"),setTimeout(function(){window.location.href="toon://mwap/window?params="+JSON.stringify({functionType:1})},2e3),Promise.reject(t);default:return Promise.reject(t)}},function(t){return Promise.reject(t)});e.getSessionId=function(t,e,n){function i(t,n){return window.sessionStorage.setItem("Authorization",t),$http.defaults.headers.Authorization=t,e&&e(n)}return window.sessionStorage.getItem("Authorization")?i(window.sessionStorage.getItem("Authorization")):void $http.post(o+"/v1/open/getSessionId?code="+t).then(function(t){if(0===t.meta.code)return i(t.data.tokenType+";"+t.data.accessToken,t)}).catch(function(t){return n&&n(t)})},e.serverTime=function(){return sessionStorage.getItem("Authorization")&&n(sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(o+"/time/range").then(function(e){t(e)}).catch(function(t){e(t)})})},e.userInfo=function(){return sessionStorage.getItem("Authorization")&&n(sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(o+"/user/info").then(function(e){t(e)}).catch(function(t){e(t)})})},e.ticketList=function(t,e){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(n,i){$http.get(o+"/ticket/listByProductId?productId="+t,e).then(function(t){n(t)}).catch(function(t){i(t)})})},e.ticketChange=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.post(o+"/ticket/change",t).then(function(t){e(t)}).catch(function(t){n(t)})})},e.ticketListByOrderNo=function(){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(o+"/ticket/listByOrderNo/"+params).then(function(e){t(e)}).catch(function(t){e(t)})})},e.ticketRefund=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.post(o+"/ticket/refund",{tid:t}).then(function(t){e(t)}).catch(function(t){n(t)})})},e.orderCreate=function(t){return sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.post(o+"/order/save",t).then(function(t){e(t)}).catch(function(t){n(t)})})},e.orderDetail=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.get(o+"/order/details/"+t).then(function(t){e(t)}).catch(function(t){n(t)})})},e.orderCancel=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.post(o+"/order/cancel",{orderno:t}).then(function(t){e(t)}).catch(function(t){n(t)})})},e.orderPay=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.post(o+"/order/pay",{orderno:t}).then(function(t){e(t)}).catch(function(t){n(t)})})},e.orderPayCallback=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.post(o+"/v1/open/queryOrder",t).then(function(t){e(t)}).catch(function(t){n(t)})})},e.orderList=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.get(o+"/order/list/"+t).then(function(t){e(t)}).catch(function(t){n(t)})})},e.orderDelete=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.post(o+"/order/delete",{orderno:t}).then(function(t){e(t)}).catch(function(t){n(t)})})},e.listCanRefundOrChange=function(){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(o+"/ticket/listCanRefundOrChange").then(function(e){t(e)}).catch(function(t){e(t)})})},e.ticketDetails=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.get(o+"/ticket/info/"+t).then(function(t){e(t)}).catch(function(t){n(t)})})},e.goPay=function(t){return window.sessionStorage.getItem("Authorization")&&n(window.sessionStorage.getItem("Authorization")),new Promise(function(e,n){$http.post(o+"/v1/open/pay",t).then(function(t){e(t)}).catch(function(t){n(t)})})}},32:function(t,e,n){n(160);var o=n(1)(n(105),n(269),"data-v-3d7f8aba",null);t.exports=o.exports},90:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"Header",props:["title"],methods:{backEvent:function(){this.$router.go(-1)},closeEvent:function(){},moreEvent:function(){}}}},105:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(129),s=o(i);e.default=s.default},129:function(t,e,n){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=n(244),s=o(i),a=n(3),r=n(2);e.default={name:"ticketPayDetail",data:function(){return{title:"订单详情",showStatus:1,orderInfo:{flag:1},ticketInfo:{ticketName:""},isFlag:0}},components:{Header:s.default},methods:{init:function(){this.resetData("all"),$util.setTitle("订单详情"),this.getOrderInfo()},resetData:function(t){switch(t){case"all":}},ticketPay:function(t){(0,r.orderPay)(t.epOrderNo).then(function(t){0===t.meta.code&&(window.location.href=t.data.url)})},ticketRefund:function(t){var e=(0,a.dateFormat)("hh",(new Date).getTime());(0,a.dateFormat)("hh:mm",t.addTime);window.navigator&&window.navigator.onLine?e<16?(0,a.confirm)({show:!0,title:"确认要退票?",message:"退票会收取票价5%手续费，费用会在5个工作日内返回到您的账户",btnEscFun:function(){},btnOkFun:function(){(0,r.ticketRefund)(t.tid).then(function(e){0===e.meta.code?e.data.tid===t.tid&&$util.toast({visible:!0,message:"退票成功",position:"middle"}):$util.toast({visible:!0,message:"退票失败",position:"middle"})})}}):(0,a.confirm)({show:!0,title:"当前不可退票",message:"晚于游览日期下午16:00的票,不可进行退票操作",btnEscFun:function(){},btnOkFun:function(){}}):$util.toast({visible:!0,message:"网络异常，请检查网络设置",position:"middle"})},ticketChange:function(t){this.$router.push({name:"ticketChange",params:{id:t.epOrderNo}})},getOrderInfo:function(){var t=this;window.navigator&&window.navigator.onLine?(0,r.orderDetail)(this.$route.params.id).then(function(e){0===e.meta.code&&(t.orderInfo=e.data.orderInfo,console.log(e.data.orderInfo),t.isFlag=e.data.orderInfo,t.orderInfo.addTime=(0,a.dateFormat)("yyyy-MM-dd hh:mm:ss.S",e.data.orderInfo.addTime),e.data.ticketList.forEach(function(e,n){e.epOrderNo===t.$route.params.id&&(t.ticketInfo=e)}))}).catch(function(t){$util.toast({visible:!0,message:t.meta.message,position:"middle"})}):$util.toast({visible:!0,message:"网络异常，请检查网络设置",position:"middle"})}},beforeRouteEnter:function(t,e,n){n()},activated:function(){this.init()},mounted:function(){}}},160:function(t,e){},188:function(t,e){},244:function(t,e,n){n(188);var o=n(1)(n(90),n(296),"data-v-b95cdc00",null);t.exports=o.exports},269:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"ticket-detail"},[n("div",{staticClass:"ticket-container"},[n("div",{staticClass:"ticket-status"},[2===t.orderInfo.flag?n("div",{staticClass:"ticket-box"},[n("div",{staticClass:"icon icon-pay",style:{backgroundImage:"url("+t.ticketInfo.qr+")",backgroundSize:"auto",backgroundPosition:"-20px -596px"}}),t._v(" "),t._m(0)]):3===t.orderInfo.flag?n("div",{staticClass:"ticket-box"},[n("div",{staticClass:"icon icon-pay",style:{backgroundImage:"url("+t.ticketInfo.qr+")",backgroundSize:"auto",backgroundPosition:"-20px -596px"}}),t._v(" "),t._m(1)]):t._e()]),t._v(" "),n("div",{staticClass:"ticket-info"},[n("div",{staticClass:"item"},[t._v("\n        订单状态\n        "),1===t.orderInfo.flag?n("span",{staticClass:"orders"},[t._v("未支付")]):t._e(),t._v(" "),2===t.orderInfo.flag?n("span",{staticClass:"orders"},[t._v("已支付")]):t._e(),t._v(" "),3===t.orderInfo.flag?n("span",{staticClass:"orders"},[t._v("已失效")]):t._e(),t._v(" "),4===t.orderInfo.flag?n("span",{staticClass:"orders"},[t._v("已取消")]):t._e(),t._v(" "),8===t.orderInfo.flag?n("span",{staticClass:"orders"},[t._v("处理中")]):t._e(),t._v(" "),9===t.orderInfo.flag?n("span",{staticClass:"orders"},[t._v("订单异常")]):t._e()]),t._v(" "),n("div",{staticClass:"item"},[t._v("\n        订单号\n        "),n("span",[t._v(t._s(t.orderInfo.epOrderNo))])]),t._v(" "),n("div",{staticClass:"item"},[t._v("\n        订单金额\n        "),n("span",[t._v(t._s(t.orderInfo.amount?t.orderInfo.amount.toFixed(2):0)+" 元")])]),t._v(" "),n("div",{staticClass:"item"},[t._v("\n        下单时间\n        "),n("span",[t._v(t._s(t.orderInfo.addTime))])])]),t._v(" "),n("div",{staticClass:"ticket-content"},[n("h3",[t._v(t._s(t.ticketInfo.ticketName))]),t._v(" "),n("div",{staticClass:"item"},[t._v("\n        类型\n        "),n("span",[t._v(t._s(1===t.ticketInfo.ticketType?"全价票":"半价票"))])]),t._v(" "),n("div",{staticClass:"item"},[t._v("\n        人数\n        "),n("span",[t._v(t._s(t.ticketInfo.manNum)+" 人")])]),t._v(" "),n("div",{staticClass:"item"},[t._v("\n        票价\n        "),n("span",[t._v(t._s(t.ticketInfo.singlePrice?t.ticketInfo.singlePrice.toFixed(2):0)+" 元")])]),t._v(" "),n("div",{staticClass:"item"},[t._v("\n        总金额\n        "),n("span",[t._v(t._s(t.ticketInfo.singlePrice?(t.ticketInfo.singlePrice*t.ticketInfo.manNum).toFixed(2):0)+" 元")])]),t._v(" "),n("div",{staticClass:"item"},[t._v("\n        票号\n        "),n("span",[t._v(t._s(t.ticketInfo.tid))])]),t._v(" "),n("div",{staticClass:"item"},[t._v("\n        浏览日期\n        "),n("span",[t._v(t._s(t.ticketInfo.useTime))])])])]),t._v(" "),n("div",{staticClass:"ticket-btn border-top"},[1===t.orderInfo.flag||8===t.orderInfo.flag?n("div",[n("button",{staticClass:"border",on:{click:function(e){t.ticketCancel(t.ticketInfo)}}},[t._v("取消订单")]),t._v(" "),n("button",{staticClass:"border pay-btn",on:{click:function(e){t.ticketPay(t.ticketInfo)}}},[t._v("去支付")])]):t._e(),t._v(" "),2===t.orderInfo.flag?n("div",[n("button",{staticClass:"border",on:{click:function(e){t.ticketRefund(t.ticketInfo)}}},[t._v("退票")]),t._v(" "),n("button",{staticClass:"border pay-btn",on:{click:function(e){t.ticketChange(t.ticketInfo)}}},[t._v("改签")])]):t._e(),t._v(" "),3===t.orderInfo.flag||4===t.orderInfo.flag?n("div",[n("button",{staticClass:"border",on:{click:function(e){t.ticketDelete(t.ticketInfo)}}},[t._v("删除订单")])]):t._e()])])},staticRenderFns:[function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"detail-pay"},[n("h3",[t._v("兑票时请出示此二维码")])])},function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"detail-pay"},[n("h3",[t._v("兑票时请出示此二维码")])])}]}},296:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"header border-bottom"},[n("i",{staticClass:"icon icon-back",on:{click:t.backEvent}}),t._v(" "),n("i",{staticClass:"icon icon-close",staticStyle:{"margin-left":"17px"},on:{click:t.closeEvent}}),t._v(" "),n("h5",[t._v(t._s(t.title))]),t._v(" "),n("i",{staticClass:"icon icon-point",on:{click:t.moreEvent}})])},staticRenderFns:[]}}});