webpackJsonp([12],{2:function(t,e){"use strict";function i(t){$http.defaults.headers.Authorization=t}Object.defineProperty(e,"__esModule",{value:!0});var o=window.CONFIG.DEV?window.CONFIG.API_DEV:window.CONFIG.API_HOST,n=function(t){window.alert(t)};$http.defaults.headers.sessionId=window.sessionStorage.getItem("sessionId");var s={SUCCESS:"0",TIMEOUT:"500",TOKEN_INVALID:"5001",CODE_INVALID:"5002"};$http.interceptors.response.use(function(t){var e=t.meta&&t.meta.code+"";switch(e){case s.SUCCESS:return t;case s.TOKEN_INVALID:case s.CODE_INVALID:return window.sessionStorage.removeItem("sessionId"),$http.defaults.headers.sessionId=void 0,n(t.meta.message||"当前会话已过期"),setTimeout(function(){window.location.href="toon://mwap/window?params="+JSON.stringify({functionType:1})},2e3),Promise.reject(t);default:return Promise.reject(t)}},function(t){return Promise.reject(t)});e.getSessionId=function(t,e,i){function n(t,i){return window.sessionStorage.setItem("Authorization",t),$http.defaults.headers.Authorization=t,e&&e(i)}return window.sessionStorage.getItem("Authorization")?n(window.sessionStorage.getItem("Authorization")):void $http.post(o+"/v1/open/getSessionId?code="+t).then(function(t){if(0===t.meta.code)return n(t.data.tokenType+";"+t.data.accessToken,t)}).catch(function(t){return i&&i(t)})},e.serverTime=function(){return sessionStorage.getItem("Authorization")&&i(sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(o+"/time/range").then(function(e){t(e)}).catch(function(t){e(t)})})},e.userInfo=function(){return sessionStorage.getItem("Authorization")&&i(sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(o+"/user/info").then(function(e){t(e)}).catch(function(t){e(t)})})},e.ticketList=function(t,e){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(i,n){$http.get(o+"/ticket/listByProductId?productId="+t,e).then(function(t){i(t)}).catch(function(t){n(t)})})},e.ticketChange=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.post(o+"/ticket/change",t).then(function(t){e(t)}).catch(function(t){i(t)})})},e.ticketListByOrderNo=function(){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(o+"/ticket/listByOrderNo/"+params).then(function(e){t(e)}).catch(function(t){e(t)})})},e.ticketRefund=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.post(o+"/ticket/refund",{tid:t}).then(function(t){e(t)}).catch(function(t){i(t)})})},e.orderCreate=function(t){return sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.post(o+"/order/save",t).then(function(t){e(t)}).catch(function(t){i(t)})})},e.orderDetail=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.get(o+"/order/details/"+t).then(function(t){e(t)}).catch(function(t){i(t)})})},e.orderCancel=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.post(o+"/order/cancel",{orderno:t}).then(function(t){e(t)}).catch(function(t){i(t)})})},e.orderPay=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.post(o+"/order/pay",{orderno:t}).then(function(t){e(t)}).catch(function(t){i(t)})})},e.orderPayCallback=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.post(o+"/v1/open/queryOrder",t).then(function(t){e(t)}).catch(function(t){i(t)})})},e.orderList=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.get(o+"/order/list/"+t).then(function(t){e(t)}).catch(function(t){i(t)})})},e.orderDelete=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.post(o+"/order/delete",{orderno:t}).then(function(t){e(t)}).catch(function(t){i(t)})})},e.listCanRefundOrChange=function(){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(o+"/ticket/listCanRefundOrChange").then(function(e){t(e)}).catch(function(t){e(t)})})},e.ticketDetails=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.get(o+"/ticket/info/"+t).then(function(t){e(t)}).catch(function(t){i(t)})})},e.goPay=function(t){return window.sessionStorage.getItem("Authorization")&&i(window.sessionStorage.getItem("Authorization")),new Promise(function(e,i){$http.post(o+"/v1/open/pay",t).then(function(t){e(t)}).catch(function(t){i(t)})})}},23:function(t,e,i){i(183);var o=i(1)(i(96),i(291),"data-v-a6dc3fc4",null);t.exports=o.exports},96:function(t,e,i){"use strict";function o(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var n=i(118),s=o(n);e.default=s.default},118:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(t[o]=i[o])}return t},n=i(6),a=i(3),r=i(2);e.default={name:"orderConfirm",data:function(){return{title:"确认订单",maxNum:10,total:0,bestValue:0,orderDetails:{orderNo:""},localDetails:{orderNo:""},isMinusDisabled:!1,isPlusDisabled:!1}},computed:o({},(0,n.mapGetters)(["getModelData","getNum"])),methods:{init:function(){this.resetData("all"),$util.setTitle("确认订单");var t=(0,a.sessionData)("userInfo");this.orderDetails.mobile=t.mobile,this.localDetails=(0,a.sessionData)("getModelData")?(0,a.sessionData)("getModelData"):this.getModelData,this.localDetails.mobile=t.mobile},resetData:function(t){switch(t){case"all":}},stripscript:function(t){for(var e=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]"),i="",o=0;o<t.length;o++)i+=s.substr(o,1).replace(e,"");return console.log(i),i},bindMinus:function(t){var e=t.count;e--,e>=1?(this.isMinusDisabled=!1,this.isPlusDisabled=!1):($util.toast({visible:!0,message:"购买数量最小为1",position:"middle"}),e=0,this.isMinusDisabled=!0,this.isPlusDisabled=!1),this.localDetails.count=e,(0,a.sessionData)("getModelData",this.localDetails)},bindPlus:function(t){var e=this.$refs.manual.value;e++,e>200?($util.toast({visible:!0,message:"购买数量最大为200",position:"middle"}),e=200,this.isPlusDisabled=!0,this.isMinusDisabled=!1):(this.isPlusDisabled=!1,this.isMinusDisabled=!1),this.localDetails.count=e,(0,a.sessionData)("getModelData",this.localDetails)},bindManual:function(t){var e=new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）——|{}【】‘；：”“'。，、？]");return!e.test(this.localDetails.count)&&void(0===this.localDetails.count?(this.isMinusDisabled=!0,this.isPlusDisabled=!1):this.localDetails.count>=200?(this.isMinusDisabled=!1,this.isPlusDisabled=!0):(this.isMinusDisabled=!1,this.isPlusDisabled=!1))},blurPhoneTest:function(){var t=(Number(this.$refs.phone.value),/^((13|14|15|17|18)[0-9]{1}\d{8})$/);t.test(this.localDetails.mobile)||($util.toast({visible:!0,message:"请输入合法的手机号",position:"middle"}),this.localDetails.mobile="")},purchareEvent:function(){this.$store.commit("setWrapModel",!0)},createOrderEvent:function(t){var e=this,i=void 0,o=t.count;if(Number.isInteger(o)){if(o<=0)return $util.toast({visible:!0,message:"请填写购买数量",position:"middle"}),!1;if(o>200)return $util.toast({visible:!0,message:"购买数量最大为200",position:"middle"}),!1;if(i={orderinfo:{mobile:t.mobile,ifoneman:1,memo:t.remark},ticket:[{ticketid:t.id,number:o,ticketName:t.ticketName,usetime:t.usetime}]},window.navigator&&window.navigator.onLine)if(this.localDetails.count>0&&""!==t.mobile)(0,r.orderCreate)(i).then(function(t){0===t.meta.code&&e.$router.push({name:"orderCreate",query:{id:t.data.groupNo}})}).catch(function(t){$util.toast({visible:!0,message:t.meta.message,position:"middle"})});else{var n=t.mobile?"请填写购买数量":"请输入手机号";$util.toast({visible:!0,message:n,position:"middle"})}else $util.toast({visible:!0,message:"网络异常，请检查网络设置",position:"middle"})}else $util.toast({visible:!0,message:"请填写正确的购买数量",position:"middle"})}},beforeRouteEnter:function(t,e,i){i()},activated:function(){this.init()},mounted:function(){}}},183:function(t,e){},291:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"confirm-order"},[i("div",{staticClass:"confirm-order-container"},[i("div",{staticClass:"order-info"},[i("h3",[t._v(t._s(t.localDetails.ticketName))]),t._v(" "),i("p",[t._v("游览日期:  "+t._s(t.localDetails.usetime))]),t._v(" "),i("p",[t._v("票价:  "+t._s(t.localDetails.buyPrice?t.localDetails.buyPrice.toFixed(2):0)+"元")]),t._v(" "),i("span",{staticStyle:{"margin-top":"-30px"},model:{value:t.localDetails.count,callback:function(e){t.$set(t.localDetails,"count",e)},expression:"localDetails.count"}},[t._v("x "+t._s(t.localDetails.count?t.localDetails.count:0))])]),t._v(" "),i("div",{staticClass:"order-box"},[i("div",{staticClass:"order order-phone border-bottom"},[t._v("\n        手机号\n        "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.localDetails.mobile,expression:"localDetails.mobile"}],ref:"phone",attrs:{type:"number",name:"phone",onInput:"if(value.length>11) value=value.slice(0,11)"},domProps:{value:t.localDetails.mobile},on:{blur:t.blurPhoneTest,input:function(e){e.target.composing||t.$set(t.localDetails,"mobile",e.target.value)}}})]),t._v(" "),i("div",{staticClass:"order order-count border-bottom"},[t._v("\n        购买数量\n        "),i("div",{staticClass:"stepper"},[i("span",{staticClass:"icon",class:[t.isMinusDisabled?"dis-minus":"icon-minus"],on:{click:function(e){t.bindMinus(t.localDetails)}}}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model.number",value:t.localDetails.count,expression:"localDetails.count",modifiers:{number:!0}}],ref:"manual",attrs:{type:"number",max:"200",min:"1",value:"1",size:"1"},domProps:{value:t.localDetails.count},on:{input:[function(e){e.target.composing||t.$set(t.localDetails,"count",t._n(e.target.value))},t.bindManual],blur:function(e){t.$forceUpdate()}}}),t._v(" "),i("span",{staticClass:"icon",class:[t.isPlusDisabled?"dis-plus":"icon-plus"],on:{click:function(e){t.bindPlus(t.localDetails)}}})])]),t._v(" "),i("div",{staticClass:"order order-remark"},[t._v("\n        订单备注\n        "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.localDetails.remark,expression:"localDetails.remark"}],attrs:{type:"text",placeholder:"请输入备注内容"},domProps:{value:t.localDetails.remark},on:{input:function(e){e.target.composing||t.$set(t.localDetails,"remark",e.target.value)}}})])]),t._v(" "),t._m(0),t._v(" "),i("div",{staticClass:"order-submit"},[i("div",{staticClass:"order-submit-left"},[i("span",{staticClass:"price-box",model:{value:t.localDetails.count,callback:function(e){t.$set(t.localDetails,"count",e)},expression:"localDetails.count"}},[t._v("合计:  "+t._s(t.localDetails.buyPrice?(t.localDetails.buyPrice*t.localDetails.count).toFixed(2):0)+"元")]),t._v(" "),i("span",{staticClass:"ticket-box"},[t._v("票数:  "+t._s(t.localDetails.count)+"张")])]),t._v(" "),i("button",{on:{click:function(e){t.createOrderEvent(t.localDetails)}}},[t._v("提交订单")])])])])},staticRenderFns:[function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"order-hint"},[t._v("\n      温馨提示 "),i("br"),t._v(" "),i("p",[t._v("1、默认一个票类一个二维码，一码可多票，兑票时只扫码一次即可")])])}]}}});