webpackJsonp([11],{2:function(t,e){"use strict";function o(t){$http.defaults.headers.Authorization=t}Object.defineProperty(e,"__esModule",{value:!0});var n=window.CONFIG.DEV?window.CONFIG.API_DEV:window.CONFIG.API_HOST,i=function(t){window.alert(t)};$http.defaults.headers.sessionId=window.sessionStorage.getItem("sessionId");var r={SUCCESS:"0",TIMEOUT:"500",TOKEN_INVALID:"5001",CODE_INVALID:"5002"};$http.interceptors.response.use(function(t){var e=t.meta&&t.meta.code+"";switch(e){case r.SUCCESS:return t;case r.TOKEN_INVALID:case r.CODE_INVALID:return window.sessionStorage.removeItem("sessionId"),$http.defaults.headers.sessionId=void 0,i(t.meta.message||"当前会话已过期"),setTimeout(function(){window.location.href="toon://mwap/window?params="+JSON.stringify({functionType:1})},2e3),Promise.reject(t);default:return Promise.reject(t)}},function(t){return Promise.reject(t)});e.getSessionId=function(t,e,o){function i(t,o){return window.sessionStorage.setItem("Authorization",t),$http.defaults.headers.Authorization=t,e&&e(o)}return window.sessionStorage.getItem("Authorization")?i(window.sessionStorage.getItem("Authorization")):void $http.post(n+"/v1/open/getSessionId?code="+t).then(function(t){if(0===t.meta.code)return i(t.data.tokenType+";"+t.data.accessToken,t)}).catch(function(t){return o&&o(t)})},e.serverTime=function(){return sessionStorage.getItem("Authorization")&&o(sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(n+"/time/range").then(function(e){t(e)}).catch(function(t){e(t)})})},e.userInfo=function(){return sessionStorage.getItem("Authorization")&&o(sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(n+"/user/info").then(function(e){t(e)}).catch(function(t){e(t)})})},e.ticketList=function(t,e){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(o,i){$http.get(n+"/ticket/listByProductId?productId="+t,e).then(function(t){o(t)}).catch(function(t){i(t)})})},e.ticketChange=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.post(n+"/ticket/change",t).then(function(t){e(t)}).catch(function(t){o(t)})})},e.ticketListByOrderNo=function(){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(n+"/ticket/listByOrderNo/"+params).then(function(e){t(e)}).catch(function(t){e(t)})})},e.ticketRefund=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.post(n+"/ticket/refund",{tid:t}).then(function(t){e(t)}).catch(function(t){o(t)})})},e.orderCreate=function(t){return sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.post(n+"/order/save",t).then(function(t){e(t)}).catch(function(t){o(t)})})},e.orderDetail=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.get(n+"/order/details/"+t).then(function(t){e(t)}).catch(function(t){o(t)})})},e.orderCancel=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.post(n+"/order/cancel",{orderno:t}).then(function(t){e(t)}).catch(function(t){o(t)})})},e.orderPay=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.post(n+"/order/pay",{orderno:t}).then(function(t){e(t)}).catch(function(t){o(t)})})},e.orderPayCallback=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.post(n+"/v1/open/queryOrder",t).then(function(t){e(t)}).catch(function(t){o(t)})})},e.orderList=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.get(n+"/order/list/"+t).then(function(t){e(t)}).catch(function(t){o(t)})})},e.orderDelete=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.post(n+"/order/delete",{orderno:t}).then(function(t){e(t)}).catch(function(t){o(t)})})},e.listCanRefundOrChange=function(){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(t,e){$http.get(n+"/ticket/listCanRefundOrChange").then(function(e){t(e)}).catch(function(t){e(t)})})},e.ticketDetails=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.get(n+"/ticket/info/"+t).then(function(t){e(t)}).catch(function(t){o(t)})})},e.goPay=function(t){return window.sessionStorage.getItem("Authorization")&&o(window.sessionStorage.getItem("Authorization")),new Promise(function(e,o){$http.post(n+"/v1/open/pay",t).then(function(t){e(t)}).catch(function(t){o(t)})})}},24:function(t,e,o){o(137);var n=o(1)(o(97),o(246),"data-v-0428e134",null);t.exports=n.exports},97:function(t,e,o){"use strict";function n(t){return t&&t.__esModule?t:{default:t}}Object.defineProperty(e,"__esModule",{value:!0});var i=o(119),r=n(i);e.default=r.default},119:function(t,e,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=o(2),i=o(3);e.default={name:"createOrder",data:function(){return{hours:0,minutes:0,seconds:0,mills:0,timer:null,orderInfo:{ticketName:""},addTime:""}},beforeCreate:function(){clearInterval(this.timer),this.timer=null},methods:{init:function(){clearInterval(this.timer),this.resetData("all"),$util.setTitle("订单"),this.getOrderdetail()},resetData:function(t){switch(t){case"all":}},getOrderdetail:function(){var t=this,e=this.$route.query.id;window.navigator&&window.navigator.onLine?(0,n.orderDetail)(e).then(function(e){if(0===e.meta.code){var o=(0,i.sessionData)("getModelData");t.orderInfo=e.data.orderInfo,t.addTime=e.data.orderInfo.addTime,t.timeCount(e.data.orderInfo.addTime),t.orderInfo.addTime=(0,i.dateFormat)("yyyy/MM/dd hh:mm:ss",e.data.orderInfo.addTime),t.orderInfo.ticketName=o.ticketName,t.orderInfo.buyPrice=o.buyPrice,t.orderInfo.count=o.count,t.orderInfo.useTime=e.data.ticketList[0].useTime}}).catch(function(t){$util.toast({visible:!0,message:t.meta.message,position:"middle"})}):$util.toast({visible:!0,message:"网络异常，请检查网络设置",position:"middle"})},timeCount:function(t){var e=this,o=function(){var o=864e5,n=Number(t)+Number(o),i=n-(new Date).getTime();if(i>0){var r=parseInt(i/36e5%24);e.hours=r;var s=i%36e5,a=parseInt(s/6e4);e.minutes=a;var c=s%6e4,u=parseInt(c/1e3);e.seconds=u,i<1e3&&(clearInterval(e.timer),e.timer=null)}else console.log("订单已失效"),clearInterval(e.timer)};o(),this.timer=setInterval(function(){o()},1),this.$once("hook:beforeDestroy",function(){clearInterval(e.timer)})},cancelOrderEvent:function(t){var e=this;window.navigator&&window.navigator.onLine?(0,i.confirm)({show:!0,title:"",message:"确认取消订单?",btnEscFun:function(){},btnOkFun:function(){(0,n.orderCancel)(t.epOrderNo).then(function(t){0===t.meta.code&&t.data&&($util.toast({visible:!0,message:"订单已取消",position:"middle"}),window.location.reload())}).catch(function(t){$util.toast({visible:!0,message:t.meta.message,position:"middle"})}),clearInterval(e.timer),e.orderStatus=!0}}):$util.toast({visible:!0,message:"网络异常，请检查网络设置",position:"middle"})},orderDeleteEvent:function(t){var e=this;window.navigator&&window.navigator.onLine?(0,i.confirm)({show:!0,title:"",message:"确认取消订单?",btnEscFun:function(){},btnOkFun:function(){(0,n.orderDelete)(t.epOrderNo).then(function(t){0===t.meta.code&&t.data&&($util.toast({visible:!0,message:"删除成功",position:"middle"}),e.$router.push({name:"scenicSpotDetail"}))}).catch(function(t){$util.toast({visible:!0,message:t.meta.message,position:"middle"})})}}):$util.toast({visible:!0,message:"网络异常，请检查网络设置",position:"middle"})},clickPayOrderEvent:function(t){window.sessionStorage.removeItem("setDate"),window.sessionStorage.setItem("orderno",t.epOrderNo),window.sessionStorage.setItem("groupNo",t.groupNo),window.sessionStorage.setItem("ticketId",t.ticketId),this.$router.push({name:"goPay",query:{orderNo:this.orderInfo.epOrderNo,orderAmount:this.orderInfo.amount,orderName:this.orderInfo.ticketName}})}},beforeRouteEnter:function(t,e,o){e.path.indexOf("/detail/order")!==-1&&window.sessionStorage.removeItem("orderno"),o()},beforeRouteLeave:function(t,e,o){var n=this.$route.params.id;t.path.indexOf("/detail/order")!==-1&&this.$router.push({name:"scenicSpotDetail",params:{id:n}}),o()},activated:function(){this.init()},mounted:function(){},beforeDestroy:function(){clearInterval(this.timer),this.timer=null}}},137:function(t,e){},246:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("div",{staticClass:"create-order"},[o("div",{staticClass:"create-order-container"},[o("div",{staticClass:"order order-time"},[1===t.orderInfo.flag||8===t.orderInfo.flag?o("div",[o("i",{staticClass:"icon icon-clock"}),t._v("\n          剩余 "+t._s(t.hours<10?"0"+t.hours:t.hours)+" 时 "+t._s(t.minutes<10?"0"+t.minutes:t.minutes)+" 分 "+t._s(t.seconds<10?"0"+t.seconds:t.seconds)+" 秒\n          "),1===t.orderInfo.flag?o("span",[t._v(" 待支付")]):t._e(),t._v(" "),8===t.orderInfo.flag?o("span",[t._v("处理中")]):t._e()]):4===t.orderInfo.flag?o("p",{staticClass:"cancel-text"},[t._v("订单已取消")]):3===t.orderInfo.flag?o("p",{staticClass:"cancel-text"},[t._v("订单已失效")]):t._e()]),t._v(" "),o("div",{staticClass:"order order-info"},[o("h3",[t._v(t._s(t.orderInfo.ticketName))]),t._v(" "),o("p",{staticStyle:{"margin-top":"10px"}},[t._v("游览日期:  "+t._s(t.orderInfo.useTime))]),t._v(" "),o("p",[t._v("票价:  "+t._s(t.orderInfo.buyPrice?t.orderInfo.buyPrice.toFixed(2):0)+" 元")]),t._v(" "),o("span",[t._v("x "+t._s(t.orderInfo.count))])]),t._v(" "),o("div",{staticClass:"order order-text"},[o("p",[t._v("\n        订单号\n        "),o("span",[t._v(t._s(t.orderInfo.epOrderNo))])]),t._v(" "),o("p",[t._v("订单金额\n      "),o("span",[t._v(t._s(t.orderInfo.amount?t.orderInfo.amount.toFixed(2):0)+" 元")])]),t._v(" "),o("p",[t._v("下单时间\n      "),o("span",[t._v(t._s(t.orderInfo.addTime))])])]),t._v(" "),o("div",{staticClass:"order-confirm border-top"},[1===t.orderInfo.flag?o("button",{staticClass:"cancel-order border",on:{click:function(e){t.cancelOrderEvent(t.orderInfo)}}},[t._v("取消订单")]):t._e(),t._v(" "),1===t.orderInfo.flag||8===t.orderInfo.flag?o("button",{staticClass:"pay-order",on:{click:function(e){t.clickPayOrderEvent(t.orderInfo)}}},[t._v(" 去支付")]):t._e(),t._v(" "),3===t.orderInfo.flag||4===t.orderInfo.flag?o("button",{staticClass:"cancel-order border",on:{click:function(e){t.orderDeleteEvent(t.orderInfo)}}},[t._v("删除订单")]):t._e()])])])},staticRenderFns:[]}}});